<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Inspections History</title>
    <!-- MODIFIED: Linking to dashboard.css for the card styles -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/dashboard.css') }}">
    <link rel="icon" href="{{ url_for('static', filename='images/icon.png') }}" type="image/png">
</head>

<body>
    <header>
        <div class="header-content">
            <img src="{{ url_for('static', filename='images/icon.png') }}" alt="SafeServe Icon" class="title-icon">
            <h2>Inspections History</h2>
        </div>
        <p class="moto-text"><a href="/hotel_dashboard" style="color: inherit; text-decoration: none;">&larr; Back to
                Dashboard</a></p>
    </header>

    <!-- MODIFIED: Changed from a table to a card container, just like the feedback page -->
    <div class="dashboard" id="inspections-container" style="display: block; grid-template-columns: 1fr; gap: 1.5rem;">
        <p style="text-align: center;">Loading inspection history...</p>
    </div>

    <script>
        document.addEventListener("DOMContentLoaded", function () {
            const hotelId = sessionStorage.getItem('hotel_id');

            if (!hotelId) {
                document.getElementById('inspections-container').innerHTML = '<p style="text-align: center;">Could not find Hotel ID. Please log in again.</p>';
                return;
            }

            fetch(`/api/hotel_inspections?hotel_id=${hotelId}`)
                .then(response => response.json())
                .then(data => {
                    const inspectionsContainer = document.getElementById("inspections-container");
                    inspectionsContainer.innerHTML = ''; // Clear the "Loading..." message

                    if (data.length === 0) {
                        inspectionsContainer.innerHTML = '<p style="text-align: center;">No inspection records found for your hotel.</p>';
                        return;
                    }

                    // MODIFIED: Loop through each inspection and create a card instead of a table row
                    data.forEach(inspection => {
                        const inspectionCard = document.createElement("div");
                        inspectionCard.classList.add("card"); // Use the same 'card' class as the feedback page
                        inspectionCard.innerHTML = `
                            <div class="card-header">
                                <h3>Inspection ID: ${inspection.inspection_id}</h3>
                            </div>
                            <p><strong>Date:</strong> ${new Date(inspection.inspection_date).toLocaleDateString()}</p>
                            <p><strong>Inspector ID:</strong> ${inspection.inspector_id}</p>
                            <p><strong>Result:</strong> ${inspection.overall_result}</p>
                            <hr style="margin: 15px 0;">
                            <p class="card-description" style="margin-top: 10px;"><strong>Comments:</strong> ${inspection.comments || 'N/A'}</p>
                        `;
                        inspectionsContainer.appendChild(inspectionCard);
                    });
                })
                .catch(error => {
                    console.error('Error fetching inspection history:', error);
                    document.getElementById('inspections-container').innerHTML = '<p style="text-align: center;">Error loading data. Please try again later.</p>';
                });
        });
    </script>
</body>

</html>