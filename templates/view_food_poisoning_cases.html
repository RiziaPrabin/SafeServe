<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Food Poisoning Reports</title>
    <!-- Link to the beautiful stylesheet -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/view_cases.css') }}">
    <link rel="icon" href="{{ url_for('static', filename='images/icon.png') }}" type="image/png">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap">
</head>

<body>
    <!-- Centered Header Section -->
    <header>
        <img src="{{ url_for('static', filename='images/icon.png') }}" alt="SafeServe Icon" class="header-icon">
        <h1 class="title">SafeServe</h1>
        <p class="caption">Your Trusted Partner for Safe and Quality Dining Experiences</p>
        <!-- This link is now styled to be in the top right -->
        <a href="/inspector_dashboard" class="back-link">&larr; Back to Dashboard</a>
    </header>

    <!-- Main Content Container -->
    <div class="container">
        <h2 class="page-title">Food Poisoning Reports</h2>
        <table class="data-table">
            <thead>
                <tr>
                    <th>Case ID</th>
                    <th>Hotel ID</th>
                    <th>Report Date</th>
                    <th>Symptoms</th>
                    <th>Status</th>
                    <th>Conclusion</th>
                    <th>Action</th> <!-- Column for the update button -->
                </tr>
            </thead>
            <tbody id="cases-tbody">
                <!-- Data will be inserted here by JavaScript -->
            </tbody>
        </table>
    </div>

    <script>
        document.addEventListener("DOMContentLoaded", function () {
            fetch('/api/food_poisoning_cases')
                .then(response => response.json())
                .then(data => {
                    const tbody = document.getElementById('cases-tbody');
                    tbody.innerHTML = '';

                    if (data.length === 0) {
                        tbody.innerHTML =
                            '<tr><td colspan="7" style="text-align:center; padding: 20px;">No cases reported yet.</td></tr>';
                        return;
                    }

                    data.forEach(caseItem => {
                        // Each row now includes a styled "Update" button that links to the update page
                        const row = `
                            <tr>
                                <td>${caseItem.case_id}</td>
                                <td>${caseItem.hotel_id}</td>
                                <td>${new Date(caseItem.report_date).toLocaleDateString()}</td>
                                <td>${caseItem.symptoms}</td>
                                <td>${caseItem.investigation_status}</td>
                                <td>${caseItem.conclusion || 'N/A'}</td>
                                <td><a href="/update_case_page/${caseItem.case_id}" class="action-btn-small">Update</a></td>
                            </tr>
                        `;
                        tbody.innerHTML += row;
                    });
                })
                .catch(error => {
                    console.error('Error fetching cases:', error);
                    tbody.innerHTML =
                        '<tr><td colspan="7" style="text-align:center; padding: 20px;">Error loading data.</td></tr>';
                });
        });
    </script>
</body>

</html>